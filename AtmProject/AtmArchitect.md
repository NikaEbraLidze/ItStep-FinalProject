# 🏦 ATM ოპერაციების პროექტი: .NET 3-Tier არქიტექტურა

ეს დოკუმენტი აღწერს ATM ოპერაციების პროექტის სტრუქტურას, რომელიც აგებულია **3-Tier არქიტექტურის** პრინციპებზე.

პროექტი შედგება 4 ძირითადი ფენისგან (პროექტისგან): Presentation, Business Logic, Data Access და Shared Models.

---

## 1. 🎯 მიზანი და ფუნქციონალი

პროექტის მიზანია შეასრულოს საბაზისო ATM ოპერაციები (ბალანსის შემოწმება, შეტანა, განაღდება, ისტორიის ნახვა) და უზრუნველყოს:

- **ავტორიზაცია:** მომხმარებლის იდენტიფიკაცია პირადი ნომრითა და პაროლით.
- **მონაცემთა მუდმივობა:** მომხმარებლისა და ტრანზაქციის მონაცემების შენახვა **JSON** ფაილებში.
- **ლოგირება:** ყველა შესრულებული ოპერაციის დეტალური აღრიცხვა (ტრანზაქციის ისტორია).

## 2. 🏗️ არქიტექტურის მიმოხილვა

პროექტის სტრუქტურა მოიცავს შემდეგ პროექტებს და მათ შორის არსებულ დამოკიდებულებებს:

| ფენა (Tier)        | პროექტის სახელი | ტიპი          | როლი                                           | დამოკიდებულება          |
| :----------------- | :-------------- | :------------ | :--------------------------------------------- | :---------------------- |
| **Presentation**   | `Atm.App`       | Console App   | მომხმარებლის ინტერფეისი.                       | `Atm.BLL`, `Atm.Models` |
| **Business Logic** | `Atm.BLL`       | Class Library | შეიცავს ყველა ბიზნეს წესს და ვალიდაციას.       | `Atm.DAL`, `Atm.Models` |
| **Data Access**    | `Atm.DAL`       | Class Library | პასუხისმგებელია ფაილურ ოპერაციებზე (JSON I/O). | `Atm.Models`            |
| **Shared Models**  | `Atm.Models`    | Class Library | ინახავს ყველა მონაცემთა სტრუქტურას (DTO-ებს).  | -                       |

---

## 3. 📂 პროექტების დეტალური სტრუქტურა და კლასები

### 3.1. `Atm.Models` (Shared Data Structure)

ეს პროექტი ინახავს მონაცემთა ობიექტებს, რომლებიც საერთოა ყველა ფენისთვის.

| ფაილი                | კლასი/ტიპი             | აღწერა                            | მახასიათებლები                                                                              |
| :------------------- | :--------------------- | :-------------------------------- | :------------------------------------------------------------------------------------------ |
| **`User.cs`**        | `class User`           | ATM მომხმარებლის პროფილი.         | `Id`, `FirstName`, `LastName`, `PersonalNumber`, `Password` (4-ციფრა), `Balance` (decimal). |
| **`Transaction.cs`** | `class Transaction`    | ერთი ოპერაციის (ლოგის) სტრუქტურა. | `UserId`, `Type` (`TransactionType`), `Amount`, `NewBalance`, `DateTime`.                   |
| **`Enums.cs`**       | `enum TransactionType` | ოპერაციის ტიპები.                 | `CheckBalance`, `Deposit`, `Withdrawal`, `Registration`.                                    |

### 3.2. `Atm.DAL` (Data Access Layer)

ეს ფენა იზოლირებს ფაილურ ოპერაციებს ბიზნეს ლოგიკისგან. გამოიყენება `System.Text.Json` სერიალიზაციისთვის.

| ფაილი                      | კლასი                     | პასუხისმგებლობა                                        | ძირითადი მეთოდები                                                                     |
| :------------------------- | :------------------------ | :----------------------------------------------------- | :------------------------------------------------------------------------------------ |
| **`JsonFileManager.cs`**   | `class JsonFileManager`   | Generic მეთოდები JSON ფაილების წაკითხვა/ჩაწერისთვის.   | `Load<T>(string path)`, `Save<T>(string path, T data)`                                |
| **`UserDataStore.cs`**     | `class UserDataStore`     | მომხმარებლის მონაცემების მართვა (`users.json`).        | `LoadUsers()`, `SaveUsers(List<User>)`, `GetNextId()`, `GetUserByPersonalNumber(...)` |
| **`TransactionLogger.cs`** | `class TransactionLogger` | ტრანზაქციის ობიექტების ლოგირება (`transactions.json`). | `Log(Transaction)`, `LoadUserHistory(int userId)`                                     |

### 3.3. `Atm.BLL` (Business Logic Layer)

ეს ფენა განსაზღვრავს, თუ როგორ უნდა შესრულდეს ATM ოპერაციები. იგი იყენებს `Atm.DAL`-ს მონაცემების მისაღებად და შესანახად.

| ფაილი                       | კლასი                      | პასუხისმგებლობა                        | ძირითადი მეთოდები                                                       |
| :-------------------------- | :------------------------- | :------------------------------------- | :---------------------------------------------------------------------- |
| **`AccountService.cs`**     | `class AccountService`     | ATM-ის ძირითადი ოპერაციების შესრულება. | `Login(pN, pass)`, `RegisterUser(...)`                                  |
| **`TransactionService.cs`** | `class TransactionService` | ფინანსური ოპერაციები.                  | `Deposit(User, amount)`, `Withdraw(User, amount)`, `CheckBalance(User)` |
| **`PasswordGenerator.cs`**  | `class PasswordGenerator`  | 4-ნიშნა პაროლის გენერაცია.             | `Generate()`                                                            |

### 3.4. `Atm.App` (Presentation Layer - Console Application)

პროექტის შესრულებადი ნაწილი. პასუხისმგებელია მომხმარებლისგან შეტანის მიღებასა და შედეგების გამოტანაზე.

| ფაილი                | კლასი               | პასუხისმგებლობა                                                                            |
| :------------------- | :------------------ | :----------------------------------------------------------------------------------------- |
| **`Program.cs`**     | `class Program`     | აპლიკაციის შესრულების დაწყება, `AccountService`-ის ინიციალიზაცია.                          |
| **`MenuHandler.cs`** | `class MenuHandler` | მენიუს გამოტანა, მომხმარებლისგან შეტანის მიღება, `AccountService`-ის მეთოდების გამოძახება. |

---

## 4. 🔗 ლოგირების მექანიზმი

ყველა ოპერაცია აისახება `TransactionLogger.cs`-ის მეშვეობით, რომელიც ინახავს `Transaction` ობიექტს JSON ფაილში.

### ლოგირების მაგალითი (პროცესი):

1.  **`Atm.App`** იღებს განაღდების ბრძანებას.
2.  იძახებს **`Atm.BLL`**-ის `TransactionService.Withdraw(user, 50)`.
3.  `Withdraw` მეთოდი:
    - ამოწმებს ბალანსს.
    - ასრულებს ოპერაციას (`user.Balance -= 50`).
    - იძახებს **`Atm.DAL`**-ის `TransactionLogger.Log()`-ს, გადასცემს `Transaction` ობიექტს.
4.  `TransactionLogger` ქმნის ახალ ლოგს და ამატებს მას `transactions.json` ფაილში.

### 📝 ლოგის ფორმატი (JSON)

```json
[
  {
    "UserId": 1,
    "Type": "Withdrawal",
    "Amount": 50.0,
    "NewBalance": 450.0,
    "DateTime": "2025-11-27T13:45:00.1234567+04:00"
  }
]
```
